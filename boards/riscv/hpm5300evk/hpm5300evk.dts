/*
 * Copyright 2022 hpmicro
 * SPDX-License-Identifier: Apache-2.0
 */

/dts-v1/;

#include <hpmicro/hpm6750.dtsi>
#include "hpm6750evk-pinctrl.dtsi"

/ {
	model = "HPMicro HPM6750EVK";
	compatible = "HPMicro,hpm6750evk";

	chosen {
		zephyr,console = &uart0;
		zephyr,shell-uart = &uart0;
		zephyr,sram = &sram;
		zephyr,itcm = &ilm;
		zephyr,dtcm = &dlm;
		zephyr,flash = &flash0;
		zephyr,code-partition = &slot0_partition;
        zephyr,canbus = &can0;
	};

	dram: memory@40000000 {
		device_type = "memory";
		reg = <0x40000000 DT_SIZE_M(16)>;
	};

	leds {
		compatible = "gpio-leds";
		led_r: led_r {
			gpios = <&gpiob 11 GPIO_ACTIVE_HIGH>;
			label = "LEDR";
		};
		led_g: led_g {
			gpios = <&gpiob 12 GPIO_ACTIVE_HIGH>;
			label = "LEDG";
		};
		led_b: led_b {
			gpios = <&gpiob 13 GPIO_ACTIVE_HIGH>;
			label = "LEDB";
		};
	};

	pwmleds {
		compatible = "pwm-leds";
		pwm_led0: pwm_led_0 {
			pwms = <&pwm2 0 PWM_MSEC(20) PWM_POLARITY_NORMAL>;
			label = "Green PWM LED";
			status = "okay";
		};
	};
	pwm_trig {
		pwm_trig0: pwm_trig0 {
			pwms = <&pwm2 8 PWM_MSEC(20) PWM_TRIG_ENABLE>;
			label = "PWM TRIG ADC";
			status = "okay";
		};
	};

	aliases {
		led0 = &led_r;
		led1 = &led_g;
		led2 = &led_b;
		pwm-led0 = &pwm_led0;
		pwm-2 = &pwm2;
	};
};

&uart0 {
	status = "okay";
	current-speed = <115200>;
	pinctrl-0 = <&pinmux_uart0>;
	pinctrl-names = "default";
	uart-idle-trgm-reg = <0xF022C000>;
	uart-idle-trgm-pin = <115>;
	uart-idle-trgm-input-src = <0x0B>;
	uart-idle-trgm-output-gptmr-in = <0x38>;
	uart-idle-trgm-output-gptmr-sync = <0x37>;
	uart-idle-gptmr-reg = <0xF3010000>;
	uart-idle-gptmr-clock-name = <18743311>;
	dmas = <&hdma 0 8>, <&hdma 1 9>;
	dma-names = "rx", "tx";
};

&uart13 {
	status = "okay";
	current-speed = <115200>;
	pinctrl-0 = <&pinmux_uart13>;
	pinctrl-names = "default";
	uart-idle-trgm-reg = <0xF022C000>;
	uart-idle-trgm-pin = <115>;
	uart-idle-trgm-input-src = <0x0B>;
	uart-idle-trgm-output-gptmr-in = <0x3b>;
	uart-idle-trgm-output-gptmr-sync = <0x3a>;
	uart-idle-gptmr-reg = <0xF3014000>;
	uart-idle-gptmr-clock-name = <18808848>;
	dmas = <&hdma 2 0x22>, <&hdma 3 0x23>;
	dma-names = "rx", "tx";
};

&gpiob {
	pinctrl-0 = <&pinmux_gpiob>;
	pinctrl-names = "default";
	status = "okay";
};
&gpioe {
	pinctrl-0 = <&pinmux_gpioe>;
	pinctrl-names = "default";
	status = "okay";
};
&i2c0 {
	status = "okay";
	pinctrl-0 = <&pinmux_i2c0>;
	pinctrl-names = "default";
};
&spi2 {
	status = "okay";
	pinctrl-0 = <&pinmux_spi2>;
	pinctrl-names = "default";
	cs-gpios = <&gpioe 31 GPIO_ACTIVE_LOW>;
	/* HDMA channels 0 and 1, muxed to SPI2 RX and TX */
	dmas = <&hdma 0 4>, <&hdma 1 5>;
	dma-names = "rx", "tx";
};
&hdma {
	status = "okay";
};
&xdma {
	status = "okay";
};
&pwm2 {
	status = "okay";
	period-init = <50>;
	dead-zone-in-half-cycle = <100>;
	pinctrl-0 = <&pinmux_pwm2>;
	pinctrl-names = "default";
};

&adc0 {
	status = "okay";
	pinctrl-0 = <&pinmux_adc0>;
	pinctrl-names = "default";
	trig-base = <0xF020C000>;
	trig-num = <0x14>;
	trig-input-src = <48>;
};

&adc3 {
	status = "okay";
	pinctrl-0 = <&pinmux_adc3>;
	pinctrl-names = "default";
	trig-base = <0xF020C000>;
	trig-num = <0x14>;
	trig-input-src = <51>;
};

&flash0 {
	status = "okay";
	partitions {
		compatible = "fixed-partitions";
		#address-cells = <1>;
		#size-cells = <1>;

		boot_partition: partition@0 {
			label = "mcuboot";
			reg = <0x0 0x3000>;
		};

		slot0_partition: partition@3000 {
			label = "image-0";
			reg = <0x3000 DT_SIZE_M(4)>;
		};
    };
};
&can0 {
    status = "okay";
    pinctrl-0 = <&pinmux_can0>;
    pinctrl-names = "default";
    	can-transceiver {
		max-bitrate = <5000000>;
	};
};
